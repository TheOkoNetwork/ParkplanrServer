{"version":3,"sources":["../../lib/cedarfair/index.js"],"names":["SeaWorld","require","Moment","relaxedJson","s_specialHours","Symbol","CedarFairPark","options","name","auth_token","api_base","special_hours","concat","Cache","Wrap","Promise","resolve","reject","GetAPIUrl","url","APIBase","ParkID","then","productData","i","product","id","purchaseLink","indexOf","replace","venueData","details","j","detail","description","bind","FindScheduleDataURL","scheduleURL","HTTP","data","toString","JSONData","parse","e","Name","FetchStaticScheduleData","scheduleData","main","mainParkHours","ParseOpeningLegend","legend","month","day","dayRow","today","monthIdx","months","hoursIdx","hours","dayIdx","class","tz","index","year","Timezone","Schedule","SetDate","date","openingTime","clone","set","get","closingTime","type","specialHourIdx","specialHours","specialLegend","specialMonthIdx","specialHoursIdx","specialDayIdx","regex_legendTimes","legendData","schedule","legendIdxA","legendA","legendIdxB","times","exec","toUpperCase","module","exports"],"mappings":"AAAA;;AAEA;AACA;AACA;AACA;;;;;;;;;;AACA,IAAIA,WAAWC,QAAQ,cAAR,CAAf;AACA,IAAIC,SAASD,QAAQ,iBAAR,CAAb;;AAEA;AACA,IAAIE,cAAcF,QAAQ,cAAR,CAAlB;;AAEA;AACA;AACA;AACA,IAAIG,iBAAiBC,QAArB;;AAEA;;;;;;IAKMC,a;;;AACF;;;;;;;;;;AAUA,6BAA0B;AAAA,YAAdC,OAAc,uEAAJ,EAAI;;AAAA;;AACtBA,gBAAQC,IAAR,GAAeD,QAAQC,IAAR,IAAgB,iBAA/B;;AAEA;AACAD,gBAAQE,UAAR,GAAqBF,QAAQE,UAAR,IAAsB,qBAA3C;AACAF,gBAAQG,QAAR,GAAmBH,QAAQG,QAAR,IAAoB,0BAAvC;;AAEA;;AAGA;AAVsB,kIAQhBH,OARgB;;AAWtB,cAAKH,cAAL,IAAuBG,QAAQI,aAAR,IAAyB,EAAhD;AACA;AACA,cAAKP,cAAL,IAAuB,GAAGQ,MAAH,CAAU,MAAKR,cAAL,CAAV,CAAvB;AAbsB;AAczB;;AAED;AACA;;;;;8CACsB;AAClB,mBAAO,KAAKS,KAAL,CAAWC,IAAX,CAAgB,cAAhB,EAAgC,YAAW;AAC9C,uBAAO,IAAIC,OAAJ,CAAY,UAASC,OAAT,EAAkBC,MAAlB,EAA0B;AACzC,yBAAKC,SAAL,CAAe;AACX;AACAC,6BAAQ,KAAKC,OAAb,iBAAgC,KAAKC,MAArC;AAFW,qBAAf,EAGGC,IAHH,CAGQ,UAASC,WAAT,EAAsB;AAC1B;AACA,6BAAK,IAAIC,IAAI,CAAR,EAAWC,OAAhB,EAAyBA,UAAUF,YAAYC,GAAZ,CAAnC,GAAsD;AAClD,gCAAIC,QAAQC,EAAR,IAAc,kBAAlB,EAAsC;AAClC;AACA;;AAEA;AACA,oCAAID,QAAQE,YAAR,CAAqBC,OAArB,CAA6B,YAA7B,IAA6C,CAAjD,EAAoD;AAChD,2CAAOX,OAAO,gEAAP,CAAP;AACH;;AAED,uCAAOD,QAAQS,QAAQE,YAAR,CAAqBE,OAArB,CAA6B,+BAA7B,EAA8D,EAA9D,IAAoE,gBAA5E,CAAP;AACH;AACJ;;AAED;AACA,6BAAKX,SAAL,CAAe;AACXC,iCAAQ,KAAKC,OAAb,cAA6B,KAAKC;AADvB,yBAAf,EAEGC,IAFH,CAEQ,UAACQ,SAAD,EAAe;AACnB;AACA,gCAAIA,UAAUC,OAAd,EAAuB;AACnB,qCAAK,IAAIC,IAAI,CAAR,EAAWC,MAAhB,EAAwBA,SAASH,UAAUC,OAAV,CAAkBC,GAAlB,CAAjC,GAA0D;AACtD,wCAAIC,OAAOP,EAAP,IAAa,2BAAjB,EAA8C;AAC1C,4CAAIO,OAAOC,WAAP,CAAmBN,OAAnB,CAA2B,YAA3B,IAA2C,CAA/C,EAAkD;AAC9C,mDAAOX,OAAO,gEAAP,CAAP;AACH;;AAED,+CAAOD,QAAQiB,OAAOC,WAAP,CAAmBL,OAAnB,CAA2B,+BAA3B,EAA4D,EAA5D,IAAkE,gBAA1E,CAAP;AACH;AACJ;AACJ;;AAED,mCAAOZ,OAAO,mCAAP,CAAP;AACH,yBAjBD;AAkBH,qBAnCO,CAmCNkB,IAnCM,CAmCD,IAnCC,CAHR,EAsCclB,MAtCd;AAuCH,iBAxCkB,CAwCjBkB,IAxCiB,CAwCZ,IAxCY,CAAZ,CAAP;AAyCH,aA1CsC,CA0CrCA,IA1CqC,CA0ChC,IA1CgC,CAAhC,EA0CO,KAAK,EAAL,GAAU,EA1CjB,CAAP,CADkB,CA2CW;AAChC;;;kDAEyB;AACtB,mBAAO,KAAKtB,KAAL,CAAWC,IAAX,CAAgB,eAAhB,EAAiC,YAAW;AAC/C,uBAAO,IAAIC,OAAJ,CAAY,UAASC,OAAT,EAAkBC,MAAlB,EAA0B;AACzC,yBAAKmB,mBAAL,GAA2Bd,IAA3B,CAAgC,UAASe,WAAT,EAAsB;AAClD;AACA,6BAAKC,IAAL,CAAU;AACNnB,iCAAKkB;AADC,yBAAV,EAEGf,IAFH,CAEQ,UAASiB,IAAT,EAAe;AACnBA,mCAAOA,KAAKC,QAAL,EAAP;AACA;AACA;;AAEA;AACAD,mCAAOA,KAAKV,OAAL,CAAa,uBAAb,EAAsC,EAAtC,CAAP;;AAEA;AACAU,mCAAOA,KAAKV,OAAL,CAAa,IAAb,EAAmB,EAAnB,CAAP;;AAEA;AACAU,mCAAOA,KAAKV,OAAL,CAAa,QAAb,EAAuB,EAAvB,CAAP;;AAEA;AACAU,mCAAOA,KAAKV,OAAL,CAAa,eAAb,EAA8B,EAA9B,CAAP;;AAEA;AACA,gCAAI;AACA,oCAAIY,WAAWtC,YAAYuC,KAAZ,CAAkBH,IAAlB,CAAf;AACH,6BAFD,CAEE,OAAOI,CAAP,EAAU;AACR,uCAAO1B,+CAA6C,KAAK2B,IAAlD,cAA+DD,CAA/D,CAAP;AACH;;AAED,gCAAIF,QAAJ,EAAczB,QAAQyB,QAAR;AACjB,yBAzBO,CAyBNN,IAzBM,CAyBD,IAzBC,CAFR,EA2BclB,MA3Bd;AA4BH,qBA9B+B,CA8B9BkB,IA9B8B,CA8BzB,IA9ByB,CAAhC,EA8BclB,MA9Bd;AA+BH,iBAhCkB,CAgCjBkB,IAhCiB,CAgCZ,IAhCY,CAAZ,CAAP;AAiCH,aAlCuC,CAkCtCA,IAlCsC,CAkCjC,IAlCiC,CAAjC,EAkCO,KAAK,EAAL,GAAU,EAlCjB,CAAP,CADsB,CAmCO;AAChC;;;4CAEmB;AAChB,mBAAO,IAAIpB,OAAJ,CAAY,UAASC,OAAT,EAAkBC,MAAlB,EAA0B;AACzC;AACA,qBAAK4B,uBAAL,GAA+BvB,IAA/B,CAAoC,UAASwB,YAAT,EAAuB;AACvD,wBAAI,CAACA,YAAD,IAAiB,CAACA,aAAaC,IAAnC,EAAyC;AACrC,+BAAO9B,OAAO,4CAAP,CAAP;AACH;;AAED;AACA,wBAAI+B,gBAAgBC,mBAAmBH,aAAaC,IAAb,CAAkBG,MAArC,CAApB;;AAEA,wBAAIC,KAAJ,EAAWC,GAAX,EAAgBC,MAAhB,EAAwBC,KAAxB;;AAEA;AACA,yBAAK,IAAIC,WAAW,CAApB,EAAuBJ,QAAQL,aAAaC,IAAb,CAAkBS,MAAlB,CAAyBD,UAAzB,CAA/B,GAAsE;AAClE,6BAAK,IAAIE,WAAW,CAApB,EAAuBJ,SAASF,MAAMO,KAAN,CAAYD,UAAZ,CAAhC,GAA0D;AACtD,iCAAK,IAAIE,SAAS,CAAlB,EAAqBP,MAAMC,OAAOM,QAAP,CAA3B,GAA8C;AAC1C;AACA,oCAAI,CAACP,IAAIA,GAAT,EAAc;AACd;AACA,oCAAI,CAACJ,cAAcI,IAAIQ,KAAlB,CAAL,EAA+B;;AAE/B;AACAN,wCAAQpD,OAAO2D,EAAP,CAAU;AACdT,yCAAKA,IAAIA,GADK;AAEdD,2CAAOA,MAAMW,KAFC;AAGdC,0CAAMZ,MAAMY;AAHE,iCAAV,EAIL,KAAKC,QAJA,CAAR;;AAMA,qCAAKC,QAAL,CAAcC,OAAd,CAAsB;AAClBC,0CAAMb,KADY;AAElB;AACAc,iDAAad,MAAMe,KAAN,GAAcC,GAAd,CAAkB,OAAlB,EAA2BtB,cAAcI,IAAIQ,KAAlB,EAAyBQ,WAAzB,CAAqCG,GAArC,CAAyC,OAAzC,CAA3B,EAA8ED,GAA9E,CAAkF,SAAlF,EAA6FtB,cAAcI,IAAIQ,KAAlB,EAAyBQ,WAAzB,CAAqCG,GAArC,CAAyC,SAAzC,CAA7F,CAHK;AAIlBC,iDAAalB,MAAMe,KAAN,GAAcC,GAAd,CAAkB,OAAlB,EAA2BtB,cAAcI,IAAIQ,KAAlB,EAAyBY,WAAzB,CAAqCD,GAArC,CAAyC,OAAzC,CAA3B,EAA8ED,GAA9E,CAAkF,SAAlF,EAA6FtB,cAAcI,IAAIQ,KAAlB,EAAyBY,WAAzB,CAAqCD,GAArC,CAAyC,SAAzC,CAA7F,CAJK;AAKlBE,0CAAM;AALY,iCAAtB;AAOH;AACJ;AACJ;;AAED;AACA,yBAAK,IAAIC,iBAAiB,CAArB,EAAwBC,YAA7B,EAA2CA,eAAe,KAAKvE,cAAL,EAAqBsE,gBAArB,CAA1D,GAAmG;AAC/F,4BAAI,CAAC5B,aAAa6B,YAAb,CAAL,EAAiC;;AAEjC,4BAAIC,gBAAgB3B,mBAAmBH,aAAa6B,YAAb,EAA2BzB,MAA9C,CAApB;;AAEA,6BAAK,IAAI2B,kBAAkB,CAA3B,EAA8B1B,QAAQL,aAAa6B,YAAb,EAA2BnB,MAA3B,CAAkCqB,iBAAlC,CAAtC,GAA6F;AACzF,iCAAK,IAAIC,kBAAkB,CAA3B,EAA8BzB,SAASF,MAAMO,KAAN,CAAYoB,iBAAZ,CAAvC,GAAwE;AACpE,qCAAK,IAAIC,gBAAgB,CAAzB,EAA4B3B,MAAMC,OAAO0B,eAAP,CAAlC,GAA4D;AACxD;AACA,wCAAI,CAAC3B,IAAIA,GAAT,EAAc;AACd;AACA,wCAAI,CAACwB,cAAcxB,IAAIQ,KAAlB,CAAL,EAA+B;;AAE/B;AACAN,4CAAQpD,OAAO2D,EAAP,CAAU;AACdT,6CAAKA,IAAIA,GADK;AAEdD,+CAAOA,MAAMW,KAFC;AAGdC,8CAAMZ,MAAMY;AAHE,qCAAV,EAIL,KAAKC,QAJA,CAAR;;AAMA,yCAAKC,QAAL,CAAcC,OAAd,CAAsB;AAClBC,8CAAMb,KADY;AAElB;AACAc,qDAAad,MAAMe,KAAN,GAAcC,GAAd,CAAkB,OAAlB,EAA2BM,cAAcxB,IAAIQ,KAAlB,EAAyBQ,WAAzB,CAAqCG,GAArC,CAAyC,OAAzC,CAA3B,EAA8ED,GAA9E,CAAkF,SAAlF,EAA6FM,cAAcxB,IAAIQ,KAAlB,EAAyBQ,WAAzB,CAAqCG,GAArC,CAAyC,SAAzC,CAA7F,CAHK;AAIlBC,qDAAalB,MAAMe,KAAN,GAAcC,GAAd,CAAkB,OAAlB,EAA2BM,cAAcxB,IAAIQ,KAAlB,EAAyBY,WAAzB,CAAqCD,GAArC,CAAyC,OAAzC,CAA3B,EAA8ED,GAA9E,CAAkF,SAAlF,EAA6FM,cAAcxB,IAAIQ,KAAlB,EAAyBY,WAAzB,CAAqCD,GAArC,CAAyC,SAAzC,CAA7F,CAJK;AAKlBE,8CAAME,YALY;AAMlBA,sDAAc;AANI,qCAAtB;AAQH;AACJ;AACJ;AACJ;;AAED3D;AACH,iBAxEmC,CAwElCmB,IAxEkC,CAwE7B,IAxE6B,CAApC,EAwEclB,MAxEd;AAyEH,aA3EkB,CA2EjBkB,IA3EiB,CA2EZ,IA3EY,CAAZ,CAAP;AA4EH;;;;EA9LuBnC,Q;;AAiM5B;;;AACA,IAAIgF,oBAAoB,4DAAxB;;AAEA,SAAS/B,kBAAT,CAA4BgC,UAA5B,EAAwC;AACpC,QAAIC,WAAW,EAAf;;AAEA;AACA,SAAK,IAAIC,aAAa,CAAjB,EAAoBC,OAAzB,EAAkCA,UAAUH,WAAWE,YAAX,CAA5C,GAAuE;AACnE,aAAK,IAAIE,aAAa,CAAjB,EAAoBnC,MAAzB,EAAiCA,SAASkC,QAAQC,YAAR,CAA1C,GAAkE;AAC9D;AACA,gBAAIC,QAAQN,kBAAkBO,IAAlB,CAAuBrC,OAAOhB,WAA9B,CAAZ;AACA,gBAAIoD,SAASA,MAAM,CAAN,CAAT,IAAqBA,MAAM,CAAN,CAAzB,EAAmC;AAC/BJ,yBAAShC,OAAOU,KAAhB,IAAyB;AACrBQ,iCAAalE,YAAUoF,MAAM,CAAN,EAASE,WAAT,EAAV,EAAoC,MAApC,CADQ;AAErBhB,iCAAatE,YAAUoF,MAAM,CAAN,EAASE,WAAT,EAAV,EAAoC,MAApC;AAFQ,iBAAzB;AAIH;AACJ;AACJ;;AAED,WAAON,QAAP;AACH;;AAEDO,OAAOC,OAAP,GAAiBpF,aAAjB","file":"index.js","sourcesContent":["\"use strict\";\r\n\r\n// woah WAT? We're based on the SeaWorld API?\r\n//  yep, SeaWorld and Cedar Fair use the same backend API framework for their park wait times\r\n//  I didn't realise this for a long time, until I checked Knott's Berry Farm and noticed the similarities\r\n//  So, to save reimplementing it from scratch, I am going to just override a few bits from the SeaWorld implementation\r\nvar SeaWorld = require(\"../seaworld/\");\r\nvar Moment = require(\"moment-timezone\");\r\n\r\n// a lenient JSON parser\r\nvar relaxedJson = require(\"relaxed-json\");\r\n\r\n// cedar parks have special hours under unique categories\r\n//  example: scary farm is listed as a separate park_id\r\n// so we need to list these here so we can combine them into our schedule data as \"special hours\"\r\nvar s_specialHours = Symbol();\r\n\r\n/**\r\n * Implements the CedarFairPark API framework.\r\n * @class\r\n * @extends SeaWorld\r\n */\r\nclass CedarFairPark extends SeaWorld {\r\n    /**\r\n     * Create new CedarFairPark Object.\r\n     * This object should not be called directly, but rather extended for each of the individual Cedar Fair parks\r\n     * @param {Object} options\r\n     * @param {String} options.park_id ID of the park to access the API for\r\n     * @param {String} [options.auth_token] Auth token to use to connect to the API\r\n     * @param {String} [options.api_base] Base URL to access the API\r\n     * @param {String[]} [options.ride_types] Array of types that denote rides at the park (to avoid listing restaurants/toilets etc. as rides)\r\n     * @param {String[]} [options.special_hours] Array of park IDs to combine with main park for special hours (eg. scaryfarm)\r\n     */\r\n    constructor(options = {}) {\r\n        options.name = options.name || \"Cedar Fair Park\";\r\n\r\n        // change defaults before calling super()\r\n        options.auth_token = options.auth_token || \"Mobile_API:merl4yU2\";\r\n        options.api_base = options.api_base || \"https://cf.te2.biz/rest/\";\r\n\r\n        // inherit from base class\r\n        super(options);\r\n\r\n        // optional special hour parks\r\n        this[s_specialHours] = options.special_hours || [];\r\n        // make sure we're an array\r\n        this[s_specialHours] = [].concat(this[s_specialHours]);\r\n    }\r\n\r\n    // sadly, the Cedar Fair API doesn't have park hours (it just returns an empty array)\r\n    //  so, let's override it from SeaWorld\r\n    FindScheduleDataURL() {\r\n        return this.Cache.Wrap(\"schedule_url\", function() {\r\n            return new Promise(function(resolve, reject) {\r\n                this.GetAPIUrl({\r\n                    // the park hours URL is kept in the products area\r\n                    url: `${this.APIBase}commerce/${this.ParkID}/products/all`\r\n                }).then(function(productData) {\r\n                    // got product data, we're looking for GUEST_PARK_HOURS to get our schedule URL\r\n                    for (var i = 0, product; product = productData[i++];) {\r\n                        if (product.id == \"GUEST_PARK_HOURS\") {\r\n                            // this will give us the park-hours.htm document\r\n                            //  we want the schedule.js script that contains all the hours data\r\n\r\n                            // check we're still getting the expected park-hours.htm document\r\n                            if (product.purchaseLink.indexOf(\"park-hours\") < 0) {\r\n                                return reject(\"Park hours URL has changed, requires themeparks library update\");\r\n                            }\r\n\r\n                            return resolve(product.purchaseLink.replace(/park-hours[a-zA-Z0-9_-]*\\.htm/, \"\") + \"js/schedule.js\");\r\n                        }\r\n                    }\r\n\r\n                    // failed? search the main venue data instead\r\n                    this.GetAPIUrl({\r\n                        url: `${this.APIBase}venue/${this.ParkID}`\r\n                    }).then((venueData) => {\r\n                        // search venue data\r\n                        if (venueData.details) {\r\n                            for (var j = 0, detail; detail = venueData.details[j++];) {\r\n                                if (detail.id == \"info_web_hours_directions\") {\r\n                                    if (detail.description.indexOf(\"park-hours\") < 0) {\r\n                                        return reject(\"Park hours URL has changed, requires themeparks library update\");\r\n                                    }\r\n\r\n                                    return resolve(detail.description.replace(/park-hours[a-zA-Z0-9_-]*\\.htm/, \"\") + \"js/schedule.js\");\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        return reject(\"Unable to discover park hours URL\");\r\n                    });\r\n                }.bind(this), reject);\r\n            }.bind(this));\r\n        }.bind(this), 60 * 60 * 24); // cache URL for 24 hours\r\n    }\r\n\r\n    FetchStaticScheduleData() {\r\n        return this.Cache.Wrap(\"schedule_data\", function() {\r\n            return new Promise(function(resolve, reject) {\r\n                this.FindScheduleDataURL().then(function(scheduleURL) {\r\n                    // notice we don't use the API here, this is hosted outside the API, so do a normal API request\r\n                    this.HTTP({\r\n                        url: scheduleURL\r\n                    }).then(function(data) {\r\n                        data = data.toString();\r\n                        // strip out data around the key JSON object\r\n                        //  this isn't pretty, but avoids having to manually embed this data into the library, which would be worse\r\n\r\n                        // remove js var init\r\n                        data = data.replace(/var\\s+schedule\\s*=\\s*/, \"\");\r\n\r\n                        // remove semi-colon\r\n                        data = data.replace(/;/g, \"\");\r\n\r\n                        // remove leading non-{ characters\r\n                        data = data.replace(/^[^{]+/, \"\");\r\n\r\n                        // remove any extra variables after initial one\r\n                        data = data.replace(/var[\\S\\s]*$/mg, \"\");\r\n\r\n                        // use our lenient JSON parser\r\n                        try {\r\n                            var JSONData = relaxedJson.parse(data);\r\n                        } catch (e) {\r\n                            return reject(`Failed to parse response data from ${this.Name} API: ${e}`);\r\n                        }\r\n\r\n                        if (JSONData) resolve(JSONData);\r\n                    }.bind(this), reject);\r\n                }.bind(this), reject);\r\n            }.bind(this));\r\n        }.bind(this), 60 * 60 * 24); // cache for 24 hours\r\n    }\r\n\r\n    FetchOpeningTimes() {\r\n        return new Promise(function(resolve, reject) {\r\n            // get our schedule data\r\n            this.FetchStaticScheduleData().then(function(scheduleData) {\r\n                if (!scheduleData || !scheduleData.main) {\r\n                    return reject(\"Unable to find main schedule data for park\");\r\n                }\r\n\r\n                // parse park legend to figure out possible opening hours\r\n                var mainParkHours = ParseOpeningLegend(scheduleData.main.legend);\r\n\r\n                var month, day, dayRow, today;\r\n\r\n                // cycle through main park hours\r\n                for (var monthIdx = 0; month = scheduleData.main.months[monthIdx++];) {\r\n                    for (var hoursIdx = 0; dayRow = month.hours[hoursIdx++];) {\r\n                        for (var dayIdx = 0; day = dayRow[dayIdx++];) {\r\n                            // skip this entry if there is no day set\r\n                            if (!day.day) continue;\r\n                            // skip this entry if the class doesn't appear in the legend\r\n                            if (!mainParkHours[day.class]) continue;\r\n\r\n                            // figure out this day in the local timezone\r\n                            today = Moment.tz({\r\n                                day: day.day,\r\n                                month: month.index,\r\n                                year: month.year\r\n                            }, this.Timezone);\r\n\r\n                            this.Schedule.SetDate({\r\n                                date: today,\r\n                                // clone today and overwrite the hours from the park legend\r\n                                openingTime: today.clone().set(\"hours\", mainParkHours[day.class].openingTime.get(\"hours\")).set(\"minutes\", mainParkHours[day.class].openingTime.get(\"minutes\")),\r\n                                closingTime: today.clone().set(\"hours\", mainParkHours[day.class].closingTime.get(\"hours\")).set(\"minutes\", mainParkHours[day.class].closingTime.get(\"minutes\")),\r\n                                type: \"Operating\"\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // if we have special hours, inject these into main hours\r\n                for (var specialHourIdx = 0, specialHours; specialHours = this[s_specialHours][specialHourIdx++];) {\r\n                    if (!scheduleData[specialHours]) continue;\r\n\r\n                    var specialLegend = ParseOpeningLegend(scheduleData[specialHours].legend);\r\n\r\n                    for (var specialMonthIdx = 0; month = scheduleData[specialHours].months[specialMonthIdx++];) {\r\n                        for (var specialHoursIdx = 0; dayRow = month.hours[specialHoursIdx++];) {\r\n                            for (var specialDayIdx = 0; day = dayRow[specialDayIdx++];) {\r\n                                // skip this entry if there is no day set\r\n                                if (!day.day) continue;\r\n                                // skip this entry if the class doesn't appear in the legend\r\n                                if (!specialLegend[day.class]) continue;\r\n\r\n                                // figure out this day in the local timezone\r\n                                today = Moment.tz({\r\n                                    day: day.day,\r\n                                    month: month.index,\r\n                                    year: month.year\r\n                                }, this.Timezone);\r\n\r\n                                this.Schedule.SetDate({\r\n                                    date: today,\r\n                                    // clone today and overwrite the hours from the park legend\r\n                                    openingTime: today.clone().set(\"hours\", specialLegend[day.class].openingTime.get(\"hours\")).set(\"minutes\", specialLegend[day.class].openingTime.get(\"minutes\")),\r\n                                    closingTime: today.clone().set(\"hours\", specialLegend[day.class].closingTime.get(\"hours\")).set(\"minutes\", specialLegend[day.class].closingTime.get(\"minutes\")),\r\n                                    type: specialHours,\r\n                                    specialHours: true\r\n                                });\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\r\n                resolve();\r\n            }.bind(this), reject);\r\n        }.bind(this));\r\n    }\r\n}\r\n\r\n// move this outside the class as it's just a convenience class and doens't need to be exposed\r\nvar regex_legendTimes = /([0-9]+(?::[0-9]+)?[ap]m)\\s*-\\s*([0-9]+(?::[0-9]+)?[ap]m)/i;\r\n\r\nfunction ParseOpeningLegend(legendData) {\r\n    var schedule = {};\r\n\r\n    // legends are inside two loops. Not totally sure why, but might be a lazy formatting choice for the HTML result\r\n    for (var legendIdxA = 0, legendA; legendA = legendData[legendIdxA++];) {\r\n        for (var legendIdxB = 0, legend; legend = legendA[legendIdxB++];) {\r\n            // try to parse times out of description\r\n            var times = regex_legendTimes.exec(legend.description);\r\n            if (times && times[1] && times[2]) {\r\n                schedule[legend.class] = {\r\n                    openingTime: Moment(`${times[1].toUpperCase()}`, \"H:mA\"),\r\n                    closingTime: Moment(`${times[2].toUpperCase()}`, \"H:mA\"),\r\n                };\r\n            }\r\n        }\r\n    }\r\n\r\n    return schedule;\r\n}\r\n\r\nmodule.exports = CedarFairPark;"]}